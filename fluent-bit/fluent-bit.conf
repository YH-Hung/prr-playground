[SERVICE]
    Flush        1
    Daemon       Off
    Log_Level    info
    Parsers_File /fluent-bit/etc/parsers.conf

[INPUT]
    Name              tail
    Path              /var/log/app/app.log
    Tag               app
    DB                /tmp/flb_app.db
    Mem_Buf_Limit     10MB
    Skip_Long_Lines   On
    Refresh_Interval  1

[FILTER]
    Name                parser
    Match               app
    Key_Name            log
    Parser              json
    Reserve_Data        On
    Preserve_Key        Off

[FILTER]
    Name                lua
    Match               app
    script              /fluent-bit/etc/aggregate.lua
    call                combine_logs

[OUTPUT]
    Name            stdout
    Match           app

[OUTPUT]
    Name                es
    Match               app
    Host                elasticsearch
    Port                9200
    Index               requests-%Y-%m-%d
    Logstash_Format     On
    Logstash_Prefix     requests
    Replace_Dots        On
    Generate_ID         On
    Suppress_Type_Name  On

